import asyncio
import time,sys
import pandas as pd
from scan_telegram import *
from scan_telegram import send_message_to_a_channel,get_channel_data
from Extract_trade_intents import check_for_orders,pre_process_data
import init_alice_blue
from init_alice_blue import generate_access_token
from nsetools import Nse
import datetime
import os
import json
from alice_blue import *
global time_start
time_start = time.time()
global minutes
minutes = 0

def event_handler_quote_update(message):
    #print(f"quote update {message}")
    global latest_price
    latest_price=message['ask_prices'][0]
    #print(f"1 Best ask price of the scrip is {latest_price}")
    #return latest_price

def open_callback():
    global socket_opened
    socket_opened = True
	
global telegram_bot_data
global alice_blue_bot_data
json_data_dir=''
with open(json_data_dir+'alice_blue_bot_data.json') as json_data:
     alice_blue_bot_data = json.load(json_data)
with open(json_data_dir+'telegram_bot_data.json') as json_data:
     telegram_bot_data = json.load(json_data)
working_dir=telegram_bot_data['working_directory']  

alice = AliceBlue(username=alice_blue_bot_data['username'], password=alice_blue_bot_data['password'], access_token=alice_blue_bot_data['access_token'])
socket_opened = False
alice.start_websocket(subscribe_callback=event_handler_quote_update,
                      socket_open_callback=open_callback,
                      run_in_background=True)
					  
					  
order=alice.place_order(transaction_type = TransactionType.Sell,
                     instrument = alice.get_instrument_by_symbol('NSE', 'SONATSOFTW-EQ'),
                     quantity = qty,
                     order_type = OrderType.Limit,
                     product_type = ProductType.Intraday,
                     price = ltp,
                     trigger_price = None,
                     stop_loss = None,
                     square_off = None,
                     trailing_sl = None,
                     is_amo = False)

alice.get_balance()
					 
{'status': 'success',
 'message': '',
 'data': {'cash_positions': [{'utilized': {'var_margin': '0.00',
     'unrealised_m2m': '-0.00',
     'span_margin': '0.00',
     'realised_m2m': '0.65',
     'premium_present': '0',
     'pay_out': '0.00',
     'multiplier': '1.00',
     'exposure_margin': '0.00',
     'elm': '0.00',
     'debits': '-0.30'},
    'segment': 'ALL',
    'net': '411.21',
    'category': 'ABFS-COMMON',
    'available': {'pay_in': '0',
     'notionalCash': '0.000000',
     'direct_collateral_value': '0.00',
     'credits': '410.91',
     'collateral_value': '0.00',
     'cashmarginavailable': '410.91',
     'adhoc_margin': '0.000000'}},
   {'utilized': {'var_margin': '0.00',
     'unrealised_m2m': '-0.00',
     'span_margin': '0.00',
     'realised_m2m': '-0.00',
     'premium_present': '0',
     'pay_out': '0.00',
     'multiplier': '1.00',
     'exposure_margin': '0.00',
     'elm': '0.00',
     'debits': '0.00'},
    'segment': 'COM',
    'net': '0.00',
    'category': 'NO_VAL',
    'available': {'pay_in': '0',
     'notionalCash': '0.000000',
     'direct_collateral_value': '0.00',
     'credits': '0.00',
     'collateral_value': '0.00',
     'cashmarginavailable': '0.00',
     'adhoc_margin': '0.000000'}}]}}
	 
print(alice.get_daywise_positions())
{'status': 'success', 'message': '', 'data': {'positions': [{'sell_amount_mtm': '102.08', 'enabled': True, 'unrealised_pnl': '0.00', 'net_amount_mtm': -0.28, 'total_sell_quantity': 4, 'ltp': 25.5, 'average_buy_price_mtm': '25.59', 'realised_pnl': '-0.25', 'close_price_mtm': 0.0, 'multiplier': 1, 'cf_sell_quantity': 0, 'average_sell_price_mtm': '25.52', 'fill_id': None, 'cf_buy_quantity': 0, 'bep': '0.00', 'sell_quantity': '4', 'buy_amount': '102.36', 'trading_symbol': 'MOREPENLAB-EQ', 'instrument_token': '2259', 'cf_average_sell_price': 0, 'net_quantity': 0, 'oms_order_id': None, 'client_id': 'AB126971', 'close_price': 0.0, 'total_buy_quantity': 4, 'm2m': '-0.25', 'buy_quantity': '4', 'cf_average_buy_price': 0, 'strike_price': '0', 'average_buy_price': '25.59', 'product': 'CNC', 'buy_amount_mtm': '102.36', 'exchange': 'NSE', 'net_amount': -0.28, 'sell_amount': '102.08', 'average_sell_price': '25.52'}, {'sell_amount_mtm': '231.6', 'enabled': True, 'unrealised_pnl': '0.00', 'net_amount_mtm': 3.95, 'total_sell_quantity': 1, 'ltp': 226.65, 'average_buy_price_mtm': '227.65', 'realised_pnl': '3.95', 'close_price_mtm': 0.0, 'multiplier': 1, 'cf_sell_quantity': 0, 'average_sell_price_mtm': '231.6', 'fill_id': None, 'cf_buy_quantity': 0, 'bep': '0.00', 'sell_quantity': '1', 'buy_amount': '227.65', 'trading_symbol': 'SONATSOFTW-EQ', 'instrument_token': '6596', 'cf_average_sell_price': 0, 'net_quantity': 0, 'oms_order_id': None, 'client_id': 'AB126971', 'close_price': 0.0, 'total_buy_quantity': 1, 'm2m': '3.95', 'buy_quantity': '1', 'cf_average_buy_price': 0, 'strike_price': '0', 'average_buy_price': '227.65', 'product': 'CNC', 'buy_amount_mtm': '227.65', 'exchange': 'NSE', 'net_amount': 3.95, 'sell_amount': '231.6', 'average_sell_price': '231.6'}, {'sell_amount_mtm': '692.55', 'enabled': True, 'unrealised_pnl': '0.00', 'net_amount_mtm': 0.66, 'total_sell_quantity': 3, 'ltp': 226.65, 'average_buy_price_mtm': '230.63', 'realised_pnl': '0.65', 'close_price_mtm': 0.0, 'multiplier': 1, 'cf_sell_quantity': 0, 'average_sell_price_mtm': '230.85', 'fill_id': None, 'cf_buy_quantity': 0, 'bep': '0.00', 'sell_quantity': '3', 'buy_amount': '691.89', 'trading_symbol': 'SONATSOFTW-EQ', 'instrument_token': '6596', 'cf_average_sell_price': 0, 'net_quantity': 0, 'oms_order_id': None, 'client_id': 'AB126971', 'close_price': 0.0, 'total_buy_quantity': 3, 'm2m': '0.65', 'buy_quantity': '3', 'cf_average_buy_price': 0, 'strike_price': '0', 'average_buy_price': '230.63', 'product': 'MIS', 'buy_amount_mtm': '691.89', 'exchange': 'NSE', 'net_amount': 0.66, 'sell_amount': '692.55', 'average_sell_price': '230.85'}]}}

print(alice.get_netwise_positions())

{'status': 'success', 'message': '', 'data': {'positions': [{'enabled': True, 'cf_average_buy_price': 0.0, 'close_price': 0.0, 'fill_id': None, 'buy_amount_mtm': 102.36, 'average_sell_price': '25.52', 'multiplier': 1, 'instrument_token': '2259', 'total_buy_quantity': 4, 'sell_amount_mtm': 102.08, 'oms_order_id': None, 'ltp': 25.5, 'bep': '0.00', 'average_sell_price_mtm': '25.52', 'realised_pnl': '-0.25', 'sell_amount': '102.08', 'product': 'CNC', 'buy_quantity': '4', 'cf_buy_quantity': 0, 'unrealised_pnl': '0.00', 'client_id': 'AB126971', 'net_quantity': 0, 'average_buy_price': '25.59', 'buy_amount': '102.36', 'average_buy_price_mtm': '25.59', 'sell_quantity': '4', 'close_price_mtm': 0.0, 'm2m': '-0.25', 'cf_average_buy_price_mtm': 0.0, 'strike_price': '0', 'net_amount': -0.28, 'cf_average_sell_price_mtm': 0.0, 'net_amount_mtm': -0.25, 'exchange': 'NSE', 'cf_average_sell_price': 0.0, 'trading_symbol': 'MOREPENLAB-EQ', 'total_sell_quantity': 4, 'cf_sell_quantity': 0}, {'enabled': True, 'cf_average_buy_price': 0.0, 'close_price': 0.0, 'fill_id': None, 'buy_amount_mtm': 227.65, 'average_sell_price': '231.6', 'multiplier': 1, 'instrument_token': '6596', 'total_buy_quantity': 1, 'sell_amount_mtm': 231.6, 'oms_order_id': None, 'ltp': 226.65, 'bep': '0.00', 'average_sell_price_mtm': '231.6', 'realised_pnl': '3.95', 'sell_amount': '231.6', 'product': 'CNC', 'buy_quantity': '1', 'cf_buy_quantity': 0, 'unrealised_pnl': '0.00', 'client_id': 'AB126971', 'net_quantity': 0, 'average_buy_price': '227.65', 'buy_amount': '227.65', 'average_buy_price_mtm': '227.65', 'sell_quantity': '1', 'close_price_mtm': 0.0, 'm2m': '3.95', 'cf_average_buy_price_mtm': 0.0, 'strike_price': '0', 'net_amount': 3.95, 'cf_average_sell_price_mtm': 0.0, 'net_amount_mtm': 3.95, 'exchange': 'NSE', 'cf_average_sell_price': 0.0, 'trading_symbol': 'SONATSOFTW-EQ', 'total_sell_quantity': 1, 'cf_sell_quantity': 0}, {'enabled': True, 'cf_average_buy_price': 0.0, 'close_price': 0.0, 'fill_id': None, 'buy_amount_mtm': 691.89, 'average_sell_price': '230.85', 'multiplier': 1, 'instrument_token': '6596', 'total_buy_quantity': 3, 'sell_amount_mtm': 692.55, 'oms_order_id': None, 'ltp': 226.65, 'bep': '0.00', 'average_sell_price_mtm': '230.85', 'realised_pnl': '0.65', 'sell_amount': '692.55', 'product': 'MIS', 'buy_quantity': '3', 'cf_buy_quantity': 0, 'unrealised_pnl': '0.00', 'client_id': 'AB126971', 'net_quantity': 0, 'average_buy_price': '230.63', 'buy_amount': '691.89', 'average_buy_price_mtm': '230.63', 'sell_quantity': '3', 'close_price_mtm': 0.0, 'm2m': '0.65', 'cf_average_buy_price_mtm': 0.0, 'strike_price': '0', 'net_amount': 0.66, 'cf_average_sell_price_mtm': 0.0, 'net_amount_mtm': 0.65, 'exchange': 'NSE', 'cf_average_sell_price': 0.0, 'trading_symbol': 'SONATSOFTW-EQ', 'total_sell_quantity': 3, 'cf_sell_quantity': 0}]}}

print(alice.get_holding_positions())
{'status': 'success', 'message': 'No Holdings', 'data': {'holdings': []}}

print(alice.get_order_history())
{'status': 'success', 'message': '', 'data': {'pending_orders': [], 'completed_orders': [{'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'AUTOLITIND-EQ', 'remaining_quantity': 6, 'rejection_reason': '16387 : Security is not allowed to trade in this market  ', 'quantity': 6, 'product': 'CNC', 'price': 16.7, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'rejected', 'order_entry_time': 1593167826, 'oms_order_id': '200626000250801', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '287', 'filled_quantity': 0, 'exchange_time': 0, 'exchange_order_id': '1000000013173881', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 0.0}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'SELL', 'trading_symbol': 'MOREPENLAB-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'CNC', 'price': 25.45, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593153749, 'oms_order_id': '200626000145760', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593153749, 'exchange_order_id': '1200000005971529', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 25.45}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'MOREPENLAB-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'CNC', 'price': 25.55, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593153704, 'oms_order_id': '200626000145452', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593153704, 'exchange_order_id': '1200000005954813', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 25.55}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'SELL', 'trading_symbol': 'MOREPENLAB-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'CNC', 'price': 25.45, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593153638, 'oms_order_id': '200626000144970', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593153638, 'exchange_order_id': '1200000005934058', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 25.45}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'MOREPENLAB-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'CNC', 'price': 25.55, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593153620, 'oms_order_id': '200626000144786', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593153624, 'exchange_order_id': '1200000005929072', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 25.55}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'SELL', 'trading_symbol': 'MOREPENLAB-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'CNC', 'price': 25.6, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593152900, 'oms_order_id': '200626000138129', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593152904, 'exchange_order_id': '1200000005662971', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 25.6}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'SELL', 'trading_symbol': 'MOREPENLAB-EQ', 'remaining_quantity': 2, 'rejection_reason': 'RMS:Rule: Check T1 holdings including TT/BE/Z/T/TS ,No Holdings Present  for entity account-AB126971 across exchange across segment across product ', 'quantity': 2, 'product': 'CNC', 'price': 25.6, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'rejected', 'order_entry_time': 1593152695, 'oms_order_id': '200626000136719', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '2259', 'filled_quantity': 0, 'exchange_time': 0, 'exchange_order_id': 'NA', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 0.0}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'MOREPENLAB-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'CNC', 'price': 25.65, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593152665, 'oms_order_id': '200626000136529', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593152665, 'exchange_order_id': '1200000005577473', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 25.65}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'SELL', 'trading_symbol': 'MOREPENLAB-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'CNC', 'price': 25.6, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593152234, 'oms_order_id': '200626000132958', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593152407, 'exchange_order_id': '1200000005409949', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 25.6}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'MOREPENLAB-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'CNC', 'price': 25.6, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593152217, 'oms_order_id': '200626000132796', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593152217, 'exchange_order_id': '1200000005401424', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 25.6}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'SELL', 'trading_symbol': 'SONATSOFTW-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'MIS', 'price': 0.0, 'order_type': 'MARKET', 'order_tag': '', 'order_status': 'complete', 'order_entry_time': 1593151954, 'oms_order_id': '200626000130658', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593151955, 'exchange_order_id': '1300000005683185', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 234.1}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'SONATSOFTW-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'MIS', 'price': 230.85, 'order_type': 'LIMIT', 'order_tag': '', 'order_status': 'complete', 'order_entry_time': 1593151756, 'oms_order_id': '200626000128676', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593151910, 'exchange_order_id': '1300000005591248', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 230.85}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'SONATSOFTW-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'MIS', 'price': 0.0, 'order_type': 'MARKET', 'order_tag': '', 'order_status': 'complete', 'order_entry_time': 1593151783, 'oms_order_id': '200626000128883', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593151783, 'exchange_order_id': '1300000005602440', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 232.85}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'SELL', 'trading_symbol': 'SONATSOFTW-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'CNC', 'price': 227.5, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593151769, 'oms_order_id': '200626000128774', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593151769, 'exchange_order_id': '1300000005596419', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 231.6}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'SELL', 'trading_symbol': 'SONATSOFTW-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'MIS', 'price': 227.5, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593151748, 'oms_order_id': '200626000128615', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593151748, 'exchange_order_id': '1300000005587432', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 230.15}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'SONATSOFTW-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'MIS', 'price': 228.2, 'order_type': 'LIMIT', 'order_tag': '', 'order_status': 'complete', 'order_entry_time': 1593150592, 'oms_order_id': '200626000116711', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593150603, 'exchange_order_id': '1300000005094875', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 228.2}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'SELL', 'trading_symbol': 'SONATSOFTW-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'MIS', 'price': 228.3, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593150525, 'oms_order_id': '200626000116129', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593150525, 'exchange_order_id': '1300000005070903', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 228.3}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'SELL', 'trading_symbol': 'SONATSOFTW-EQ', 'remaining_quantity': 0, 'rejection_reason': 'order quantity is negative or zero', 'quantity': 0, 'product': 'MIS', 'price': 0.0, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'rejected', 'order_entry_time': 1593150404, 'oms_order_id': '200626000114882', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '6596', 'filled_quantity': 0, 'exchange_time': 0, 'exchange_order_id': 'NA', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 0.0}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'SONATSOFTW-EQ', 'remaining_quantity': 1, 'rejection_reason': 'RMS:Margin Exceeds,Required:455.50, Available:410.91 for entity account-AB126971 across exchange across segment across product ', 'quantity': 1, 'product': 'CNC', 'price': 227.85, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'rejected', 'order_entry_time': 1593150068, 'oms_order_id': '200626000111654', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '6596', 'filled_quantity': 0, 'exchange_time': 0, 'exchange_order_id': 'NA', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 0.0}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'SONATSOFTW-EQ', 'remaining_quantity': 0, 'rejection_reason': '--', 'quantity': 1, 'product': 'CNC', 'price': 227.65, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'complete', 'order_entry_time': 1593149182, 'oms_order_id': '200626000101494', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593149183, 'exchange_order_id': '1300000004505541', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 227.65}, {'validity': 'DAY', 'user_order_id': '1', 'trigger_price': 0.0, 'transaction_type': 'BUY', 'trading_symbol': 'SRTRANSFIN-EQ', 'remaining_quantity': 1, 'rejection_reason': 'RMS:Margin Exceeds,Required:714.85, Available:410.91 for entity account-AB126971 across exchange across segment across product ', 'quantity': 1, 'product': 'CNC', 'price': 714.85, 'order_type': 'LIMIT', 'order_tag': 'order1', 'order_status': 'rejected', 'order_entry_time': 1593143456, 'oms_order_id': '200626000011552', 'nest_request_id': '1', 'lotsize': 1, 'login_id': 'AB126971', 'leg_order_indicator': '', 'instrument_token': '4306', 'filled_quantity': 0, 'exchange_time': 0, 'exchange_order_id': 'NA', 'exchange': 'NSE', 'disclosed_quantity': 0, 'client_id': 'AB126971', 'average_price': 0.0}]}}

print(alice.get_trade_book())
{'status': 'success', 'message': '', 'data': {'trades': [{'user_order_id': '1', 'transaction_type': 'SELL', 'trading_symbol': 'MOREPENLAB-EQ', 'trade_price': 25.45, 'trade_id': '51925211', 'product': 'CNC', 'order_entry_time': 1593153749, 'oms_order_id': '200626000145760', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593153749, 'exchange_order_id': '1200000005971529', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'BUY', 'trading_symbol': 'MOREPENLAB-EQ', 'trade_price': 25.55, 'trade_id': '51920778', 'product': 'CNC', 'order_entry_time': 1593153704, 'oms_order_id': '200626000145452', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593153704, 'exchange_order_id': '1200000005954813', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'SELL', 'trading_symbol': 'MOREPENLAB-EQ', 'trade_price': 25.45, 'trade_id': '51914449', 'product': 'CNC', 'order_entry_time': 1593153638, 'oms_order_id': '200626000144970', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593153638, 'exchange_order_id': '1200000005934058', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'BUY', 'trading_symbol': 'MOREPENLAB-EQ', 'trade_price': 25.55, 'trade_id': '51912966', 'product': 'CNC', 'order_entry_time': 1593153624, 'oms_order_id': '200626000144786', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593153624, 'exchange_order_id': '1200000005929072', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'SELL', 'trading_symbol': 'MOREPENLAB-EQ', 'trade_price': 25.6, 'trade_id': '51819060', 'product': 'CNC', 'order_entry_time': 1593152904, 'oms_order_id': '200626000138129', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593152904, 'exchange_order_id': '1200000005662971', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'BUY', 'trading_symbol': 'MOREPENLAB-EQ', 'trade_price': 25.65, 'trade_id': '51788459', 'product': 'CNC', 'order_entry_time': 1593152665, 'oms_order_id': '200626000136529', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593152665, 'exchange_order_id': '1200000005577473', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'SELL', 'trading_symbol': 'MOREPENLAB-EQ', 'trade_price': 25.6, 'trade_id': '51750351', 'product': 'CNC', 'order_entry_time': 1593152407, 'oms_order_id': '200626000132958', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593152234, 'exchange_order_id': '1200000005409949', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'BUY', 'trading_symbol': 'MOREPENLAB-EQ', 'trade_price': 25.6, 'trade_id': '51722102', 'product': 'CNC', 'order_entry_time': 1593152217, 'oms_order_id': '200626000132796', 'instrument_token': '2259', 'filled_quantity': 1, 'exchange_time': 1593152217, 'exchange_order_id': '1200000005401424', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'SELL', 'trading_symbol': 'SONATSOFTW-EQ', 'trade_price': 234.1, 'trade_id': '76831206', 'product': 'MIS', 'order_entry_time': 1593151955, 'oms_order_id': '200626000130658', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593151955, 'exchange_order_id': '1300000005683185', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'BUY', 'trading_symbol': 'SONATSOFTW-EQ', 'trade_price': 232.85, 'trade_id': '76801499', 'product': 'MIS', 'order_entry_time': 1593151783, 'oms_order_id': '200626000128883', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593151783, 'exchange_order_id': '1300000005602440', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'SELL', 'trading_symbol': 'SONATSOFTW-EQ', 'trade_price': 231.6, 'trade_id': '76799147', 'product': 'CNC', 'order_entry_time': 1593151769, 'oms_order_id': '200626000128774', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593151769, 'exchange_order_id': '1300000005596419', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'BUY', 'trading_symbol': 'SONATSOFTW-EQ', 'trade_price': 230.85, 'trade_id': '76821556', 'product': 'MIS', 'order_entry_time': 1593151910, 'oms_order_id': '200626000128676', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593151756, 'exchange_order_id': '1300000005591248', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'SELL', 'trading_symbol': 'SONATSOFTW-EQ', 'trade_price': 230.15, 'trade_id': '76794291', 'product': 'MIS', 'order_entry_time': 1593151748, 'oms_order_id': '200626000128615', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593151748, 'exchange_order_id': '1300000005587432', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'BUY', 'trading_symbol': 'SONATSOFTW-EQ', 'trade_price': 228.2, 'trade_id': '76627465', 'product': 'MIS', 'order_entry_time': 1593150603, 'oms_order_id': '200626000116711', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593150592, 'exchange_order_id': '1300000005094875', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'SELL', 'trading_symbol': 'SONATSOFTW-EQ', 'trade_price': 228.3, 'trade_id': '76618181', 'product': 'MIS', 'order_entry_time': 1593150525, 'oms_order_id': '200626000116129', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593150525, 'exchange_order_id': '1300000005070903', 'exchange': 'NSE'}, {'user_order_id': '1', 'transaction_type': 'BUY', 'trading_symbol': 'SONATSOFTW-EQ', 'trade_price': 227.65, 'trade_id': '76442058', 'product': 'CNC', 'order_entry_time': 1593149183, 'oms_order_id': '200626000101494', 'instrument_token': '6596', 'filled_quantity': 1, 'exchange_time': 1593149183, 'exchange_order_id': '1300000004505541', 'exchange': 'NSE'}]}}